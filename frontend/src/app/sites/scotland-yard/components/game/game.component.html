<app-main-header/>

@let state = gameState();
@if (state) {
    <div class="main-container">
        <div class="game-container">
            <div class="config">

                <div class="highlighted-container transport-container">
                    <form [formGroup]="heatMapForm" class="inputs-container">
                        <h3 class="config-header">Mr. X</h3>

                        <input class="number-input-lg position-input" type="number" placeholder="Mr. X Position"
                               formControlName="startNode">

                        <div class="move-config">
                            <select class="move-select" [formControl]="selectedMoveControl">
                                @for (type of edgeTypes; track type) {
                                    <option [ngValue]="type">{{ type }}</option>
                                }
                            </select>
                            <button class="small-btn" (click)="addMove()">
                                <i class="bi bi-plus-circle"></i>
                            </button>
                        </div>
                    </form>

                    <div class="moves-container">
                        @for (move of moves(); track $index) {
                            <div class="move-container">
                                <button class="small-btn" style="height: fit-content" (click)="deleteMove($index)">
                                    <i class="bi bi-trash3"></i>
                                </button>
                                <div class="move" [class]="move.toString().toLowerCase()">
                                    {{ move }}
                                </div>
                            </div>
                        }
                    </div>
                </div>
                <div class="highlighted-container transport-container">
                    <div class="inputs-container">
                        <h3 class="config-header">Detectives</h3>

                        <div class="move-config">
                            <input class="number-input-lg position-input" type="number" placeholder="Detective Position"
                                   [formControl]="selectedPlayerControl">

                            <button class="small-btn" (click)="addPlayer()">
                                <i class="bi bi-plus-circle"></i>
                            </button>
                        </div>
                    </div>

                    <div class="moves-container">
                        @for (player of players(); track $index) {
                            <div class="move-container">
                                <button class="small-btn" style="height: fit-content" (click)="deletePlayer($index)">
                                    <i class="bi bi-trash3"></i>
                                </button>
                                <div class="move">
                                    {{ player }}
                                </div>
                            </div>
                        }
                    </div>
                </div>

            </div>

            <app-pan-container [centerPosition]="{x: -bounds().x / 4, y: -bounds().y / 4}" class="map">
                <!-- graph edges -->
                <svg [ngStyle]="{width: `${bounds().x}px`, height: `${bounds().y}px`}" class="test">
                    @for (edge of renderedEdges(); track edge.id) {
                        <line stroke="black"
                              stroke-width="1"
                              [attr.x1]="edge.x1"
                              [attr.y1]="edge.y1"
                              [attr.x2]="edge.x2"
                              [attr.y2]="edge.y2"
                              class="edge"
                              [class]="edge.type.toLowerCase()"
                        >
                        </line>
                    }
                </svg>

                <!-- available nodes -->
                @for (entry of renderedNodes(); track entry.node.id) {
                    <div [ngStyle]="getNodePositionStyle(entry.node.position)" class="node"
                         [class]="getNodeColorClasses(entry)">
                        <div class="node-text">{{ entry.node.id }}</div>
                    </div>
                }

                <!-- forbidden player nodes -->
                @for (entry of renderedPlayers(); track entry.node.id) {
                    <div [ngStyle]="getNodePositionStyle(entry.node.position)" class="node black">
                        <div class="node-text">{{ entry.node.id }}</div>
                    </div>
                }

                <!-- start node -->
                @let start = renderedStart();
                @if (start) {
                    <div [ngStyle]="getNodePositionStyle(start.node.position)" class="node start">
                        <div class="node-text">{{ start.node.id }}</div>
                    </div>
                }


            </app-pan-container>
        </div>
    </div>
}

